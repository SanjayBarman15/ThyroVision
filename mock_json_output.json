{
  "system_info": {
    "pipeline_name": "Thyroid Nodule TIRADS Classification System",
    "version": "1.0.0",
    "architecture": "Faster R-CNN (ResNet-101) → Xception Classifier",
    "timestamp": "2026-02-05T14:23:47.582341"
  },
  
  "identification": {
    "roi_id": "nodule_2024_001",
    "image_id": "US_thyroid_20240201_0042",
    "patient_id": "PT_2024_5678",
    "study_date": "2024-02-01",
    "acquisition_time": "14:22:15"
  },
  //keep
  "classification": {
    "predicted_class": "TR4",
    "predicted_index": 3,
    "confidence": 0.847,
    "probabilities": {
      "TR1": 0.012,
      "TR2": 0.038,
      "TR3": 0.076,
      "TR4": 0.847,
      "TR5": 0.027
    },
    "probability_array": [0.012, 0.038, 0.076, 0.847, 0.027],
    "class_names": ["TR1", "TR2", "TR3", "TR4", "TR5"],
    "num_classes": 5,
    "classification_method": "Xception CNN (ImageNet pretrained)"
  },
  
  "clinical_interpretation": {
    "tirads_category": "TR4 - Moderately Suspicious",
    "tirads_point_range": "7-11 points",
    "risk_level": "Moderately suspicious",
    "malignancy_risk_percentage": "5-20%",
    "acr_tirads_guidelines": {
      "fna_threshold_mm": 15,
      "followup_threshold_mm": 10,
      "general_recommendation": "FNA if ≥1.5cm, follow-up if ≥1.0cm"
    },
    "nodule_measurements": {
      "max_dimension_mm": 18.5,
      "min_dimension_mm": 16.2,
      "area_mm2": 299.7,
      "volume_mm3": 2847.3
    },
    "size_based_recommendation": {
      "action": "FNA_RECOMMENDED",
      "reason": "Nodule size (18.5mm) exceeds FNA threshold (15mm)",
      "urgency": "ROUTINE",
      "clinical_notes": "TR4 nodule >1.5cm requires fine needle aspiration for cytological evaluation"
    },
    "action_codes": {
      "current_action": "FNA_RECOMMENDED",
      "possible_actions": ["NO_ACTION", "MONITOR", "FOLLOW_UP", "FNA_RECOMMENDED", "URGENT_REFERRAL"]
    }
  },
  
  "gradcam_explainability": {
    "heatmap": [
      [0.02, 0.05, 0.08, 0.12, 0.09, 0.04, 0.01],
      [0.06, 0.18, 0.35, 0.42, 0.38, 0.15, 0.03],
      [0.11, 0.38, 0.72, 0.89, 0.75, 0.32, 0.08],
      [0.15, 0.45, 0.85, 1.00, 0.88, 0.41, 0.12],
      [0.10, 0.36, 0.68, 0.82, 0.71, 0.29, 0.07],
      [0.05, 0.14, 0.31, 0.38, 0.33, 0.12, 0.03],
      [0.01, 0.04, 0.07, 0.10, 0.08, 0.03, 0.01]
    ],
    "heatmap_metadata": {
      "shape": [7, 7],
      "value_range": [0.0, 1.0],
      "description": "Normalized activation map showing regions influencing classification"
    },
    "rendering_info": {
      "roi_width": 224,
      "roi_height": 224,
      "colormap": "jet",
      "suggested_alpha": 0.4,
      "usage": "Frontend upsamples 7x7 heatmap to 224x224 and overlays on ROI image"
    },
    "technical_details": {
      "target_layer": "block14_sepconv2_act",
      "target_class": "TR4",
      "layer_type": "separable_convolution",
      "activation_function": "relu"
    },
    "interpretation": {
      "peak_attention_location": "center-right region",
      "attention_description": "Model focused on hypoechoic area with irregular margins",
      "confidence_explanation": "Strong activation in suspicious features characteristic of TR4"
    }
  },
  
  "detection_metadata": {
    "faster_rcnn_detection": {
      "bbox": [120, 85, 245, 198],
      "bbox_format": "(x1, y1, x2, y2)",
      "bbox_width": 125,
      "bbox_height": 113,
      "detection_confidence": 0.934,
      "iou_threshold": 0.5,
      "nms_threshold": 0.3
    },
    "original_image": {
      "dimensions": [512, 512],
      "color_space": "grayscale",
      "bit_depth": 8,
      "format": "DICOM",
      "modality": "ultrasound"
    },
    "pixel_spacing": {
      "x_spacing_mm": 0.148,
      "y_spacing_mm": 0.148,
      "calibration_source": "DICOM_tag"
    },
    "anatomical_context": {
      "organ": "thyroid",
      "side": "right_lobe",
      "depth_cm": 2.3,
      "proximity_to_vessels": false
    }
  },
  
  "model_information": {
    "classification_model": {
      "name": "xception_tirads_classifier",
      "architecture": "Xception",
      "backbone": "ImageNet pretrained",
      "version": "1.0.0",
      "model_file": "xception_tirads_best.h5",
      "input_shape": [224, 224, 3],
      "output_shape": [5],
      "total_parameters": 22910480,
      "trainable_parameters": 22855952
    },
    "detection_model": {
      "name": "Faster R-CNN",
      "backbone": "ResNet-101",
      "framework": "PyTorch/Detectron2",
      "purpose": "Thyroid nodule region detection"
    },
    "training_info": {
      "dataset_size": 4500,
      "validation_accuracy": 0.892,
      "test_accuracy": 0.874,
      "training_date": "2024-01-15",
      "training_epochs": 150,
      "augmentation": "rotation, brightness, flip"
    },
    "gradcam_layer": "block14_sepconv2_act"
  },
  
  "processing_info": {
    "preprocessing": {
      "roi_extraction": "Faster R-CNN detection + padding",
      "resize": [224, 224],
      "normalization": "divide by 255.0 (0-1 range)",
      "color_space": "RGB",
      "interpolation": "bilinear"
    },
    "inference": {
      "device": "NVIDIA GPU (CUDA)",
      "batch_size": 1,
      "inference_time_ms": 45.2,
      "preprocessing_time_ms": 12.3,
      "postprocessing_time_ms": 8.7,
      "total_time_ms": 66.2
    },
    "quality_checks": {
      "image_quality": "acceptable",
      "roi_size_adequate": true,
      "contrast_sufficient": true,
      "artifacts_detected": false
    }
  },
  
  "confidence_metrics": {
    "classification_confidence": 0.847,
    "detection_confidence": 0.934,
    "overall_confidence": 0.891,
    "uncertainty_estimate": 0.109,
    "entropy": 0.621,
    "top_k_agreement": {
      "top_1": "TR4",
      "top_2": "TR3",
      "top_1_prob": 0.847,
      "top_2_prob": 0.076,
      "margin": 0.771
    }
  },
  
  "quality_assurance": {
    "model_validation": {
      "calibration_score": 0.94,
      "expected_accuracy": 0.87,
      "confidence_reliability": "high"
    },
    "prediction_flags": {
      "high_confidence": true,
      "borderline_case": false,
      "requires_review": false,
      "ambiguous_features": false
    },
    "recommended_actions": {
      "automated_reporting": true,
      "radiologist_review": "optional",
      "second_opinion": false
    }
  },
  
  "audit_trail": {
    "pipeline_stages": [
      {
        "stage": "image_acquisition",
        "timestamp": "2024-02-01T14:22:15",
        "status": "completed"
      },
      {
        "stage": "detection_faster_rcnn",
        "timestamp": "2026-02-05T14:23:47.450",
        "status": "completed",
        "detections_found": 1
      },
      {
        "stage": "roi_extraction",
        "timestamp": "2026-02-05T14:23:47.463",
        "status": "completed"
      },
      {
        "stage": "xception_classification",
        "timestamp": "2026-02-05T14:23:47.508",
        "status": "completed"
      },
      {
        "stage": "gradcam_generation",
        "timestamp": "2026-02-05T14:23:47.565",
        "status": "completed"
      },
      {
        "stage": "clinical_interpretation",
        "timestamp": "2026-02-05T14:23:47.582",
        "status": "completed"
      }
    ],
    "software_versions": {
      "tensorflow": "2.10.0",
      "opencv": "4.5.0",
      "numpy": "1.21.0",
      "python": "3.9.0"
    },
    "compliance": {
      "hipaa_compliant": true,
      "gdpr_compliant": true,
      "phi_anonymized": true
    }
  },
  
  "database_keys": {
    "primary_key": "nodule_2024_001",
    "foreign_keys": {
      "patient_id": "PT_2024_5678",
      "study_id": "STD_2024_001234",
      "image_id": "US_thyroid_20240201_0042"
    },
    "indexes": {
      "timestamp_index": "2026-02-05T14:23:47.582341",
      "tirads_index": "TR4",
      "action_index": "FNA_RECOMMENDED"
    }
  },
  
  "frontend_integration": {
    "display_priority": "high",
    "color_coding": {
      "risk_level": "orange",
      "hex_color": "#FF8C00"
    },
    "ui_elements": {
      "show_bbox": true,
      "show_heatmap": true,
      "show_probabilities": true,
      "show_recommendation": true
    },
    "interactive_features": {
      "gradcam_overlay_toggle": true,
      "probability_chart": "bar_chart",
      "clinical_details_expandable": true
    }
  },
  
  "export_options": {
    "formats": ["JSON", "PDF", "DICOM_SR", "HL7_FHIR"],
    "destinations": ["PACS", "EMR", "Research_Database"],
    "sharing": {
      "shareable": true,
      "encryption_required": true,
      "access_level": "clinician_only"
    }
  }
}
